{{#projects/project-header
  project=project
  shouldShowLinks=isUserMember
  shouldDisplayBottomBorder=false
}}
  {{#if shouldShowBranchFilter}}
    <div class="flex justify-end mt-1" data-test-project-container-branch-filter>
      {{#power-select
        triggerClass="ember-power-select-branch-filter-trigger"
        selected=selectedBranch
        placeholder="Filter by branch"
        renderInPlace=true
        horizontalPosition="right"
        options=projectBranches
        searchPlaceholder="Type to filter branches"
        noMatchesMessage="No branches found"
        onchange=(action "chooseBranch")
        as |branch|
      }}
        {{branch}}
      {{/power-select}}
    </div>
  {{else if (not project.organization.isVersionControlIntegrated)}}
    <div class="flex items-center p-1 pl-2 border bg-gray-000 rounded font-semibold text-sm" data-test-integration-prompt>
      <div class="flex items-center">
        {{inline-svg "github-icon" class="mr-1"}}
        {{inline-svg "gitlab-icon" class="mr-1"}}
        {{inline-svg "bitbucket-icon" class="mr-1"}}
      </div>
      <div>Integrate your SCM for repo features</div>
      {{#link-to data-test-add-integration "organizations.organization.integrations" project.organization.slug class="percy-btn percy-btn-primary percy-btn-sm leading-normal ml-2"}}Add integration{{/link-to}}
    </div>
  {{/if}}
{{/projects/project-header}}

<main class="project-container flex-1 pb-8 bg-gray-000">
  {{#if (and builds.isPending (not isRefreshing))}}
    {{loading-page}}
  {{else}}
    {{#if builds}}
      <div class="build-list">
        {{#each branchFilteredBuilds as |build|}}
          {{build-card build=build project=project}}
        {{/each}}
        {{#if shouldLoadMore}}
          {{#infinity-loader infinityModel=infinityBuilds}}
            {{loading-build-card}}
          {{/infinity-loader}}
        {{else if isBranchSelected}}
          <div class="p-4 bg-white border-b flex justify-center text-gray-400">
              To load more builds, select "All branches" from the select menu above
          </div>
        {{/if}}
      </div>
    {{else}}
      {{#if project.isEnabled}}
        {{#if isUserMember}}
          <div class="container-xl mb-3">
            <div class="build-card-placeholder">
              <div class="mr-3">
                {{build-icon}}
              </div>
              <span class="text-xl font-semibold mr-sm">Waiting for your first build</span>
              <div class="line-loader-container">
                <div class="line-loader"></div>
              </div>
            </div>
          </div>

          <div class="container-xl">
            <div class="bg-white rounded shadow-1">
              <div class="px-2 py-3 border-b">
                {{resource-widget project=project}}
              </div>
              <div class="px-2 py-3">
                <h2 class="text-xl font-semibold mb-sm">Project token</h2>
                <p class="text-gray-400 mb-2">Configure your local or CI environment with PERCY-TOKEN. This is a project-specific write-only API key that only has access to create builds, snapshots, and upload resources to this project. It should be kept secret.</p>

                {{#unless project.isDemo}}
                  {{#if project.tokens.isPending}}
                    <div class="percy-code-snippet">
                      <pre>
                        <span class="percy-code-comment percy-code-bash">Loading...</span>
                      </pre>
                    </div>
                  {{/if}}
                  {{#with project.writeOnlyToken.token as |token|}}
                    <div>
                      <div class="flex justify-start mb-1">
                        <div class="btn-toggle">
                          <div class="btn-toggle-item {{if showUnixBash 'is-selected'}}" {{action "switchBashSyntax"}}>Mac/Linux</div>
                          <div class="btn-toggle-item {{if (not showUnixBash) 'is-selected'}}" {{action "switchBashSyntax"}}>Windows</div>
                        </div>
                      </div>
                      <div class="percy-code-snippet">
                        <pre>
                          <span class="percy-code-bash">{{if showUnixBash "export" "set"}} PERCY_TOKEN={{token}}</span>
                        </pre>
                      </div>
                    </div>
                  {{/with}}
                {{else}}
                  <div class="percy-code-snippet" data-test-env-var-demo>
                    <pre>
                      <span class="percy-code-bash">PERCY_TOKEN=[This is a demo project. Create your own project to get a PERCY_TOKEN]</span>
                    </pre>
                  </div>
                {{/unless}}
                
              </div>
            </div>
          </div>
        {{else}}
          {{status-panel
            inlineSvgName="refresh-icon"
            classes="pt-8"
            mainText="This project doesn't have any builds yet."
            secondaryText="The owners of this project are working hard to get some diffs ready for you to see!"
          }}
        {{/if}}
      {{else}}
        <div class="container-xl">
          <p class="py-2 font-semibold">No builds yet, and this project is disabled.</p>
        </div>
      {{/if}}
    {{/if}}
  {{/if}}
</main>
